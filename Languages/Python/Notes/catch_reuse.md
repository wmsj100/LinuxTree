---
title: 缓存重用机制
date: 2020-02-03 09:52:37
modify: 
tags: [Notes]
categories: Python
author: wmsj100
email: wmsj100@hotmail.com
---

# 缓存重用机制

## 概要

- Python缓存机制是为了提高程序的执行效率，实际上就是Python解释器在启动时从内存中分配一小块内存空间来存储高频使用的数据，这样可以大大减少高频使用的数据创建时申请内存和销毁的内存开销。
- 通过`id`函数来获取当前变量的内存地址

## 缓存机制

### 全局缓存

> 只要之前在程序中创建过，就直接存入缓存，后续不再创建

- *之前还猜测是python已经把这些小整数已经全部写到内存中了，还想着是不是有些浪费，而且不同机器的可用内存地址肯定不一样，现在才发现是有一个创建过程的。*

- 范围在[-5~256]的小整数
- bool类型
- 字符串类型数据

### 本代码块缓存

- 大于256的整数
- 大于0的浮点型小数

### 不缓存

- 小于0的浮点型小数
- 小于-5的整数

## 测试

- 测试发现上面说的不是那个情况，只要是在一个代码块的，只要是为俩个值赋值同一个值，俩个变量的id值都是一样的。
- 位于不同代码块的引用值相同的变量，是严格按照全局变量的那个缓存机制，即只有[-5~256],bool, str类型的值id相同，其他不同。
- 一个代码块内部值相同的变量的id相同。
```python
int1 = -5
int2 = -5
print(id(int1), id(int2))

bool1 = True
bool2 = True
print(id(bool1), id(bool2))

s1 = '3344'
s2 = '3344'
print(id(s1), id(s2))

int3 = 257
int4 = 257
print(id(int3), id(int4))

f1 = 256.1
f2 = 256.1
print(id(f1), id(f2))

f3 = -2.45
f4 = -2.45
print(id(f3), id(f4))

n1 = -6
n2 = -6
print(id(n1), id(n2))

print('============================')

def func():
    int1 = -5
    print(id(int1), id(int2))
    bool1 = True
    print(id(bool1), id(bool2))
    s1 = '3344'
    print(id(s1), id(s2))
    int3 = 257
    int5 = 257
    print(id(int3), id(int4), id(int5))
    f1 = 256.1
    f3 = 256.1
    print(id(f1), id(f2), id(f3))
    f3 = -2.45
    f5 = -2.45
    print(id(f3), id(f4), id(f5))
    n1 = -6
    n3 = -6
    print(id(n1), id(n2), id(n3))

func()
# 8791391720288 8791391720288
# 8791391189328 8791391189328
# 47663736 47663736
# 45401648 45401648
# 1358920 1358920
# 1356832 1356832
# 45401488 45401488
# ============================
# 8791391720288 8791391720288
# 8791391189328 8791391189328
# 47663736 47663736
# 45401552 45401648 45401552
# 1358848 1358920 1358848
# 1358944 1356832 1358944
# 45401584 45401488 45401584
```

## 参考

- [python缓存机制](http://c.biancheng.net/view/vip_5954.html)

