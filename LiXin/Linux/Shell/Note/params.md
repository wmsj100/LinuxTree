---
title: 变量和参数
date: Sun 03 Dec 2017 08:22:56 PM CST
tag: [shell,params]
categories: Linux
author: wmsj100
mail: wmsj100@hotmail.com
---

## 定义和使用变量
- 变量的名字就是保存值的地方，引用变量的值就叫做变量替换
- var1是一个变量的名字，$var1就是引用这个变量的值，
- '$var1'是'${var1}'的简写，某些上下文中'$var1'可能会引起错误，此时就需要使用'${var1}';
- 加花括号帮助解释器识别变量的边界，推荐给所有的变量加花括号
- 已经定义的变量可以被重新定义

## 查看环境变量
- env 查看环境变量
- set 查看所有变量，包括环境变量和用户自定义变量，以及与bash操作接口有关的变量，
- export 自定义变量转换为环境变量，后面如果没有参数，会把所有的环境变量显示出来。
- declare 可以把环境变量转换为自定义变量

## 进程
- 子进程仅仅会继承父进程的环境变量，不会继承父进程的自定义变量。
- 当进入子进程bash后，父进程就处于sleep状态，
- 为什么环境变量的数据可以被子进程应用，这与内存配置有关系，当启动一个shell，操作系统会分配一记忆块给shell使用，此内存中的变量可让子进程取用，若父进程利用export，可以让自定义变量的内容写到上述的记忆块中，当加载子进程时候，子进程可以将父shell的环境变量所在的记忆块导入到自己的环境变量快中。

## locale 语系
- 查看当前环境语系，
- locale -a 查看支持的所有语系，这个时通过`i18n`来实现的。


## 只读变量
- 'readonly' 可以将变量定义为只读变量,这个和通过declare来声明创建的只读变量类似，
- 只读变量的值不能被改变。
	- readonly a=1
	- a=2; // error
    - declare -r a

## 编辑变量

### # 从前往后删除
- a=${path#*/ruby-*:}  删除内容至找到ruby开始
    - # 从开始删除，且删除最短
    - ## 符合替换文字的“最长的”哪一个
- a=${path#/*:} 删除最前面的一个目录
- a=${path##/*:} 删除目录只剩下最后一个目录，俩个#表示删除最长的内容

### % 从后往前删除
- a=${path%:/home*} 从后面往前删除，删除内容最小匹配，包括:/home也删除- a=${path%%:*bin} 从后往前删除，按照最大匹配，删除值。

### / 替换
- a=${path/sbin/SBIN}  把匹配到的第一个sbin替换为SBIN
- a=${path//sbin/SBIN} 把匹配到的所有的sbin替换为SBIN

### 变量的测试与替换
- a=${a-root} 如果变量a不存在，则创建变量a，并且赋值root
- a=${a:-root} 如果变量a不存在或赋值为空，则给变量a赋值root  有没有冒号差别很大
- a=${b+root} b没有设置，a为空;b设置为空，则a为root；b有值，a赋值为root；
- a=${b:+root} b没有设置或者赋值为空时候，a为空；b有值，a赋值root
---
- *+/-/:+/:- 这四个都不会影响到参照b的值*
---
- a=${b=root} b不存在，a=b=root; b设置为空，a=b=""; b设置值，a=$b;
- a=${b:=root} b不存在或设置为空，a=b=root; b设置值，a=$b;
---
- =/:= 会影响到参考b的值
---
- a=${b?root} b不存在，则root输出至stderr; b设置为空或有值，a=$b;
- a=${b:?root} 若b不存在或设置为空，root输出至stderr, echo $? // 1; b有值，a=$b;

### 範例
- 删除mail值的其它信息，只留下用户名
    - mail=$MAIL; // /var/spool/mail/wmsj100 
    - b=${mail#*mail/} 删除内容至/mail,包括自身
    - b=${mail##/*/} 删除俩个斜线之间最大的值

## 特殊变量
- 局部变量 这种变量只有在代码块或者函数中才可见
- 环境变量
- 位置变量 从命令行传递到脚本的参数；$0, $1, $2..
	- $0 脚本文件本身的名字， $1是第一个参数，$2是第二个参数
	- $9之后的参数就必须用花括号包裹。 ${10}, ${11};
	- $# 传递到脚本的参数个数
	- $* 以一个单字符串显示所有向脚本传递的参数。
	- $$ 脚本运行的当前进程ID号
	- $! 后台运行的最后一个进程ID号
	- $@ 与$#相同
	- $ 与set命令功能相同
	- $? 显示最后命令的退出状态。
