---
title: makefile
date: 2020-03-29 18:56:42
modify: 
tags: [Notes]
categories: Linux
author: wmsj100
email: wmsj100@hotmail.com
---

# makefile

## 概要

- 是make的执行动作的文件

## 概述

- `<target> : <prerequisites>`
- `[tab] <commands>`
- 开始的叫做目标,冒号后面的部分叫做前置条件
- 第二行必须由一个tab键起首,后面跟着命令
- 目标是必须的,不可省略;前置条件和命令都是可选的,但俩者至少存在一个.
- 每条规则就明确俩件事:构建目标的前置条件是什么,以及如何构建.

## 目标

- 一个目标就构成一条规则.目标通常是文件名,指明make命令所要构建的对象,
- 目标可以是一个文件名,也可以是多个文件名,之间用空格分割
- 除了文件名,目标还可以是某个操作的名字,这成为"伪目标"`clean:`
- 但是,如果当前目录中,正好有一个文件叫做clean,那么这个命令不会执行,因为make发现clean文件已经存在,就认为没有必要重新构建了,就不会执行指定的rm命令
- 为了避免这种情况,可以申明clean是伪目标,
- `.PHONY: clean` 这样就申明了clean是伪目标,这样make就不会去检查是否存在一个叫做clean的文件,而是每次运行都执行对应的命令.
- 如果make命令运行时没有指定目标,默认会执行Makefile文件的第一个目标.

## 前置条件

- 前置条件通常是一组文件名,之间用空格分割,它指定了"目标"是否重新构建的判断标准:只要有一个前置文件不存在,或者有过更新目标就需要重新构建

## 命令

- 表示如何更新目标文件,由一行或多行的shell命令组成,它是构建目标的具体指令,它的运行结果通常就是生成目标文件.
- 每行命令之前必须由一个tab键
- 每行命令在一个单独的shell中执行.这些shell之间没有继承关系.

## 语法

- `#`: 注释
- `@`: 通常情况执行make会在屏幕打印具体执行的命令,这叫做回声,如果在命令前面添加`@`就可以关闭回声

## 通配符

- 通配符用来指定一组符合条件的文件名,和shell的通配符一致
- `*/?/[...]`
- `*.o` 表示所有后缀名为o的文件

## 模式匹配

- make允许对文件名进行类似正则运算的匹配,主要用到的匹配符是`%`,
- 比如假定当前目录下有`f1.c/f2.c`俩个源吗文件,需要将他们编译为对应的对象文件.
- `%.o: %.c`

## 变量和赋值符

- make调用变量需要使用`$()`来包裹变量名
- 如果是调用Shell的变量,需要在美元符前面再加一个美元符号,这是因为make命令会对美元符转义
- `@echo $$HOME`

## 内置变量

- make命令提供了一系列内置变量,比如`$(CC)`指向当前使用的编译器.
- `$(MAKE)` 指向当前使用的Make工具
- 这样主要是为了跨平台的兼容性

## 自动变量

- Make命令还提供一些自动变量,他们的值与当前规则有关
- `$@` 指代当前目标,就是make命令当前构建的那个目标
	```Makefile
	a.txt b.txt:
		touch $@
	```
- `$<` 指代第一个前置条件
- `$?` 指代比目标更新的所有前置条件
- `$^` 指代所有前置条件,之间以空格分割.
## 参考

- [makefile ruanyifen](http://www.ruanyifeng.com/blog/2015/02/make.html)
