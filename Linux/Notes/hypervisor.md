---
title: hypervisor
date: 2020-04-01 19:22:13
modify: 
tags: [Notes]
categories: Linux
author: wmsj100
email: wmsj100@hotmail.com
---

# hypervisor

## 概要

- hypervisor: 一种运行在物理服务器和操作系统之间的中间层软件，可以运行多个操作系统和应用共享一套基础物理硬件。
- 可以将hypervisor看做是虚拟环境中的元操作系统，可以协调访问服务器上的所有物理设备和虚拟机，所以又称为虚拟机监视器(virtual machine monitor)。
- hypervisor是所有虚拟化技术的核心，非中断的支持多工作负载迁移是hypervisor的基本功能。
- 当服务器启动并执行hypervisor时，会给每一台虚拟机分配适量的内存，cpu，网络和磁盘资源，并且加载所有虚拟机的客户操作系统。
- hypervisor之于操作系统类似与操作系统之于进程。它们为执行提供独立的虚拟硬件平台，而虚拟硬件平台反过来又提供对底层机器的虚拟的完整访问。
- 但并不是所有的hypervisor都是一样的，

## 虚拟化和hypervisor

- 虚拟化就是通过某种方式隐藏底层物理硬件的过程，从而让多个操作系统可以透明使用和共享它。
- 这种架构的另一个更常见的名称是平台虚拟化。
- 在典型的分层架构中，提供平台虚拟化的层称为hypervisor(有时称为虚拟化管理程序或VMM).来宾操作系统称为虚拟机(VM)，因为对这些VM而言，硬件是专门针对它们虚拟化的。
- 平台虚拟化的好处很多，美国环境保护署报告的一组有趣的统计数据证明服务器和数据中心的能源效率时发现，实际上服务器只有5%的时间是在工作的。在其他时间，服务器都处于休眠状态。
- 在单个服务器上的虚拟化平台能够改善服务器的利用率，但是减少服务器的数量才是它的最大功用。
- 减少服务器数量意味着减少不动资产，能耗，冷却和管理成本。
- 使用更少的硬件还能提高可靠性。
- 总之，平台虚拟化不仅带来技术优势，还能创造成本和能源优势。
- 操作系统将对机器的底层资源的访问虚拟化为进程。
- hypervisor也做一样的事情，但其对象不是进程，而是整个操作系统。

## hypervisor分类

- hypervisor可以划分为俩类。
- 直接运行在物理硬件上面，基于内核的虚拟机KVM--它本身是一个基于操作系统的hypervisor
- 运行在另一个操作系统(运行在物理硬件之上) QEMU/WINE

## hypervisor的构成

- hypervisor(不管是什么类型)仅是一个从其来宾系统抽象机器硬件的分层应用程序。通过这种方式，每个来宾操作系统看到的仅是一个VM而不是真实的硬件机器。
- 在较高级别上，hypervisor需要少量设施启动来宾操作系统：一个需要驱动的内核映像，一个配置(IP/内存),一个磁盘和一个网络设备。最后，需要使用一组来宾操作系统工具启动和管理来宾操作系统。
- 然后，一个简化的hypervisor架构实现最后的关键功能，从而使来宾操作系统可以和宿主操作系统同时运行。
- 实现这个功能需要一些特定的要素，首先，类似于将用户空间应用程序和内核函数链接起来的系统调用，一个通常可用的虚拟化调用层允许来宾操作系统向宿主操作系统发出请求。可以在内核中虚拟化IO，或通过来宾操作系统的代码支持它。故障必须由hypervisor亲自处理，从而解决实际的故障，或将虚拟机设备故障发送给来宾操作系统。
- hypervisor还必须处理在来宾操作系统内部发生的异常。
- hypervisor的核心要素之一是页映射器，它将硬件指向特定操作系统。
- 最后使用一个高级别的调度器在hypervisor和来宾操作系统之间传输控制。
- hypervisor集成了linux内核

## Linux hypervisor的益处

- 使用Linux作为内核开发hypervisor由实实在在的好处，最明显的是，以Linux为基础开发pypervisor收益于稳步前进的Linux，以及为改进Linux投入的大量工作。
- 从典型的优化、bug修复、调度和内存管理创新到支持不同处理器架构，Linux都是一个不断进步的平台
- 不久前以及证明，通过向内核添加KVM内核模块，就可以将Linux内核转变为hypervisor
- 使用Linux作为平台的另一个奇妙好处是，除了可以将该平台作为hypervisor之外，还可以将其用作操作系统。
- 因此除了可以在Linux hypervisor上运行多个来宾操作系统之外，还可以在该级别上运行其他传统的应用程序。所以，不必担心带有新的应用编程接口的新平台，
- 标准协议(TCP/IP)和其他有用的应用程序和来宾操作系统都是可用的。

## 参考

- [hypervisor介绍](https://blog.csdn.net/baidu_23959681/article/details/82732488)
