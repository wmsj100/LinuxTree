---
title: 数据格式总结
date: 2016-06-13
tags: [Ajax]
categories: Dynamic
---

`ajax`是高性能的JS基石，它可以延迟下载资源而使页面加载更快，它通过在客户端和服务器之间异步加载数据避免了页面数据集体加载。它还用于在一次http请求中获取整个页面资源。

`ajax`是一种在和服务器通讯过程中而不重载当前页面的技术。数据可从服务器获取或发送给服务器。

向服务器请求数据有5种方法：
- XMLHttpRequest(XHR)
- Dynamic script tags insertion 动态脚本标签插入
- iframes
- Comet
- Multipart XHR 多部分的XHR

现在常用的有3种： XHR，Dynamic Script, MultipartXHR;

`XHR` -- 用来异步的收发数据。可以在请求报文中添加任意的头信息和参数，(包括GET和POST)。

`xhr.getAllResponseHeaders()` => 获取头部信息。

如果请求不改变服务器状态，只是取回数据，则使用`GET`，

`XHR` -- 最大的缺陷是不能跨域，需要借助一些跨域的手段。


动态创建脚本 -- 最大的优势就是避免了跨域的麻烦，这是一种黑客技术。但是这种方法缺陷也是大大的，不能向`XHR`那样进行精细的控制，不能设置或获取头部信息，不能设置请求的超时或重试，只能通过`GET`方式而不能使用`POST`获取数据。能做的只是等待获取数据然后处理数据。

最后一点非常重要，因为响应报文被当作JS源码，它必须是可执行的JS，不能使用裸XHR，或者JSON，任何数据，无论什么格式，都必须在一个回调函数中被组装起来。

`创建动态脚本` -- 是客户端获取并解析数据最快的方法。但是因为js没有权限和访问控制的概念，所以通过动态脚本插入的标签可以控制整个页面，或者获取页面数据，尤其是使用第三方数据时候要特别小心。

多部分XHR -- 这是目标最先进的技术，只需要一次`http`请求，就可以从服务端获取多个数据。

字符串操作是JS最慢的操作之一。
split是最快的字符串操作之一。

`json` -- 格式是下载时间快，但是需要复杂的运算来把`json`数据展示成为`HTML`；
`HTML` -- 在服务器直接解析成`HTML`时，下载时间比较慢，但是一旦下载完成之后只需要一个操作`innerHTML`就可以把内容展示到页面。 作为数据格式，它缓慢而臃肿。
---

### 总结

`JSON`和自定义分割的自定义格式最好，因为轻量，优点很多，下载速度快。
`JSON-P`数据，用动态脚本标签插入法获取，它将数据视为可运行的JS而不是字符串，解析速度极快。它能够跨域，但不应该涉及敏感数据。