---
title: 数据链路层
date: 2018-03-24 18:14:11 Sat
modify: 2018-03-24 18:14:11 Sat
tag: [net]
categories: Network
author: wmsj100
mail: wmsj100@hotmail.com
---

# 数据链路层 
## 基础概念
- 数据链路层属于计算机网络的低层
- 使用的信道主要有俩种类型：
    - 点对点信道： 使用一对一的点对点通信方式
    - 广播信道： 使用一对多的广播通信方式；过程复杂
- 局域网虽然是个网络，但局域网的问题并不归属到网络层，因为网络层研究的是多个网络互连的问题，是讨论分组怎样从一个网络通过路由器转发到另一个网络；
- 链路层的传输只是从一台主机传送到另一台主机，并不经过路由器转发。
- 数据链路层的三个基本问题是： 封装成帧、透明传输、差错检测
- 以太网MAC层的硬件地址
- 适配器、转发器、集线器、网桥、以太网交换机的作用以及使用场合
- 路由器在转发是使用的是三层协议
- 当研究数据链路层的问题时，只需要关心在协议栈中水平方向的各数据链路层。
    - 客户端链路层》路由器链路层》路由器链路层》主机链路层

## 使用点对点信道的数据链路层

### 数据链路和帧
- 链路： 从一个节点到相邻节点的物理线路（有线或无线），中间没有任何其他的交换结点。
- 数据链路： 通过通信协议控制数据在物理线路上的传输，把实现协议的硬件和软件加到链路上，就构成了数据链路。
- 现在最常用的方法是使用`网络适配器`来实现这些协议，一般的适配器都包括了数据链路层和物理层这俩层功能
- 帧： 点对点信道的数据链路层的协议数据单元
- 数据链路层把网络层交下来的数据构成帧发送到链路上，以及把接收到的帧中的数据取出并上交给网络层。

### 数据链路层通信步骤：
- 结点A把网络层交下来的IP数据报添加首部和尾部封装成帧
- 结点A把封装好的帧发送给结点B的数据链路层
- 结点B的数据链路层收到的帧无差错，则从帧中提取出IP数据报交给上面的网络层；否则丢弃这个帧

## 数据链路层协议的三个基本问题
### 封装成帧
- 所有在互联网上传输的数据都以分组（即IP数据报）为传输单位
- 网络层IP数据报就是链路层帧的数据部分
- 在一段数据的前后分别添加首部和尾部，这样就构成了一个帧
- 首部和尾部的一个重要作用就是帧定界（即确定帧的界限）
- 此外首部和尾部还包括许多必要的控制信息
- 每一种链路层协议都规定了所能传输的帧的数据部分长度上限--最大传输单元MTU(Maximum Transfer Unit)
- 帧定界可以使用特殊的帧定界符
- SOH Start Of Header 帧的首部开始
- EOT End Of Transmission 帧的结束
- 一个完整的帧必须包含`SOH`和`EOT`

### 透明传输
- 透明： 某一个实际存在的事物看起来却好像不存在一样
- 透明传输： 表示无论什么样的比特组合数据，都能够按照原样无差错地通过这个数据链路层
- 帧传输的数据中不允许出现帧的定界符，
- 如果帧数据中出现帧定界符，需要在定界符前面插入一个转义字符`ESC`，在接收端的数据链路层在把数据送往网络层之前删除这个插入的转义字符，这种方法叫做字节填充或字符填充
- 如果转义字符出现在数据中，那么就在转义字符前面再添加一个转义字符

### 差错检测
- 比特差错： 比特在传输过程中可能会出现差错，
  - 循环冗余检查（CRC）： 在数据链路层广泛使用的比特差错检测技术，就是在待传输的数据后面添加n为冗余码
  - 接收端对收到的每一帧经过CRC检查后如果余数为0表示帧没有错，可以接收；如果不为0，表示帧有差错，就丢弃
- 传输差错： 帧丢失、帧重复、帧失序；接收端接收的帧是正确的，但是整体的帧有重复或失序或丢失
  - 增加帧编号、确认和重传机制，收到正确的帧就向发送端发送确认。
  - 发送端在一定期限内没有收到对方的确认就认为出现了差错，就进行重传，直到收到对方确认为止。
- 因为现在通信质量大大改善，有链路层引起的差错概览已经大大降低，因而现在互联网采用区别对待的方法：
  1. 对于通信质量良好的传输链路，数据链路层不使用确认和重传机制，即不要求数据链路层向上层提供可靠传输服务，这个服务由上层协议来完成（TCP）
  2. 对于通信质量较差的传输链路，数据链路层就使用确认和重传机制，即向上提供可靠传输服务

## PPP 点对点协议
- PPP协议就是用户计算机和ISP（网络提供商）进行通信时所使用的数据链路层协议
- PPP协议特定： 
  - 简单：数据链路层的帧不需要纠错（只进行CRC校验）、不需要序号、也不需要流量控制，这些都在TCP中实现
  - 封装成帧：协议必须规定帧定界符，以便接收端可以准确找到帧的开始和结束
  - 透明性： 对于数据中出现帧定界符和转义符要采取有效的措施（转义）
  - 多种网络层协议： 在同一条物理链路上同时支持多种网络层协议
  - 多种类型链路： 能够在多种类型的链路上运行，如同步、异步；串行、并行；低速、高速；电的、光的；
  - 差错检查： CRC比特差错
  - 检测连接状态： 协议必须具有一种机制能够及时（不超过几分钟）自动检测链路是否处于正常工作状态；当出现故障的链路隔了一段时间后又重新恢复正常工作时要及时能检测到
  - 最大传送单元： 设置数据的最大长度值
  - 网络层地址协商： PPP协议必须能提供一种机制使通信的俩个网络层（IP层）的实体能够通过协商知道或者能配置彼此的网络层地址。因为如果仅仅在链路层建立了连接而不知道对方的网络层地址，则还不能够保证网络层可以传送分组
  - 数据压缩协商： PPP协议必须提供一种方法来协商使用数据压缩算法。

## PPP协议的组成
### PPP协议有三个组成部分
1. 一个将IP数据报封装到串行链路的方法
2. 一个用来建立、配置和测试数据链路连接的链路控制协议LCP（Link Control Protocol）。
3. 一套网络控制协议NCP（Network Control Protocol）其中的每一个协议支持不同的网络层协议，如IP网络层

## PPP协议的帧格式
- 帧的首部为四个字段，尾部为俩个字段
- 首部的第一个字段和尾部的第二个字段都是标志字段F（Flag），规定为0x7E（0X表示16进制）；表示一个帧的开始或结束。标志字段就是帧的定界符。如果出现连续俩个标志字段，表示这个一个空帧，应对丢弃
- 首部中的地址字段A规定为`0xFF`，控制字段C规定为`0x03`，空白字段，没有携带PPP帧的信息
- 首部的第四个字段是2字节的协议字段，指明网络层的协议（IP）
- 尾部的第一个字段是2字节使用crc的帧检验序列FCS
- 字节填充： 使用转义
- 零比特填充： 在发送端先通过硬件扫描数据字段，只要发现5个连续的1，就在后面填入一个0，这样可以保证信息字段中不会出现6个连续1；接收端在收到一个帧时，先找到标志字段F确定帧边界，然后再用硬件对其进行比特流扫描，每发现5个连续1就删除后面的一个0，这样保证了透明传输；在所传送的数据比特流中可以传输任意组合而不会引起帧边界的错误判断
