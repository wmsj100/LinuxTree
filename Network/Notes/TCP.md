---
title: TCP协议
date: 2018-03-18 11:08:41 Sun
modify: 2018-03-18 11:08:41 Sun
tag: [tcp,net]
categories: Network
author: wmsj100
mail: wmsj100@hotmail.com
---

# 概述
- TCP提供可靠的数据传输服务，TCP是面向连接的。应用程序在使用TCP通信之前需要先建立连接，通信结束之后需要断开连接
- TCP连接是点对点的，一条TCP连接只能连接俩个点
- TCP提供可靠传输，无差错/不丢失/不重复/按顺序
- TCP提供全双工通信，允许通信双发任何时候都能发送数据，因为TCP连接的俩端都设有发送缓存和接受缓存
- TCP面向字节流，TCP并不知道所传输数据的含义，仅把数据看作一连串的字节序列，它也不保证接收方收到的数据块和发送方发出的数据块具有大小对应关系。

## TCP报文段结构
> TCP报文段的报头有前20字节的固定部分，后面4n字节是根据需要而添加的字段。

1. 源端口和目的端口：各占俩个字节，分别写入源端口号和目的端口号，这和UDP报头类似，因为都是运输层协议。
2. 序号：占4字节，TCP是面向字节流的，通过TCP传送的字节流中的每个字节都按照顺序编号，而报头中的序号字段值则指的是本报文段数据的第一个字节的序号。
3. 确认序号：占4个字节，期望收到对方下个报文的第一个数据字节的序号
4. 数据偏移：占4位，指TCP报文段的报头长度，包括固定的20字节和选项字段
5. 保留：为以后使用，目前为0
6. 控制位：共有6个控制位，说明本报文的性质
	- URG 紧急：当URG=1时，它告诉系统此报文中有紧急数据，需要优先传送(比如紧急关闭)，这要与紧急指针配合使用
	- ACK 确认： 仅当ACK=1时确认号字段才有效。建立TCP连接后，所有报文段都必须把ACK设置为1
	- PSH 推送 若TCP连接的一端希望另一端立即响应，PSH字段便可以催促对方，不再等到缓存区填满才发送
	- RST 复位：若TCP连接出现严重差错，RST设置为1，断开TCP连接，再重新建立连接
	- SYN 同步：用于建立和释放连接
	- FIN 终止： 用于释放连接，当FIN=1，表明发送方已经发送完毕，要求释放TCP连接。
7. 窗口：窗口值是指发送者自己的接收窗口大小，因为接收缓存的空间有限
8. 校验和：和UDP报文一样，有一个校验和，用于检查报文是否在传输过程中出现差错
9. 紧急指针：当URG=1时才有效，
10. 选项：长度可变

## TCP三次握手
- TCP是面向连接的，在传输TCP报文段之前需要先创建连接，发起连接的一方被称为客户端，而响应连接请求的一方被成为服务端，而这个创建连接的过程被称为三次握手：

## TCP可靠传输的实现
- 定时器，超时重传的关键
- TCP将数据按字节排序
- 流量控制
